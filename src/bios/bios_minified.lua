local a="v0.4.3"local b=10;local c="TEST"local d="ORC_PBCP"local e="ORC_BCP"local f="ORC_BDCP"local g=1;local i=10;local j=true;local k=true;local l=true;local m=true;local n={}local o={}local p=0;local q=false;local r=computer;local s=component;local t=r.pullSignal;local u=math.random;local v=r.uptime;local w=_G.tostring;local function x(y)local r=s.list(y)()if r~=nil then return s.proxy(r)end end;net={}do local z,A,B,C,D,E={},{},{},{},r,table.unpack;net.port,net.hn,net.route,net.hook,U=4096,D.address():sub(1,8),true,{},D.uptime;for F in s.list("modem")do z[F]=s.proxy(F)z[F].open(net.port)end;local function G()local H=""for I=1,16 do H=H..string.char(u(32,126))end;return H end;local function J(H,K,L,M,N,O)if C[L]then z[C[L][1]].send(C[L][2],net.port,H,K,L,M,N,O)else for P,Q in pairs(z)do Q.broadcast(net.port,H,K,L,M,N,O)end end end;local function R(H,K,L,N,O)B[H]=U()J(H,K,L,net.hn,N,O)end;function net.send(L,N,O,K,H)K,H=K or 1,H or G()A[H]={K,L,N,O,0}R(H,K,L,N,O)end;local function S(H)for P,Q in pairs(B)do if P==H then return false end end;return true end;local T=t;function D.pullSignal(V)local W={T(V)}for P,Q in pairs(net.hook)do pcall(Q,E(W))end;for P,Q in pairs(B)do if U()>Q+30 then B[P]=nil end end;for P,Q in pairs(C)do if U()>Q[3]+30 then C[P]=nil end end;if W[1]=="modem_message"and(W[4]==net.port or W[4]==0)and S(W[6])then C[W[9]]={W[2],W[3],U()}if W[8]==net.hn then if W[7]~=2 then D.pushSignal("net_msg",W[9],W[10],W[11])if W[7]==1 then R(G(),2,W[9],W[10],W[6])end else A[W[11]]=nil end elseif net.route and S(W[6])then J(W[6],W[7],W[8],W[9],W[10],W[11])end;B[W[6]]=U()end;for P,Q in pairs(A)do if U()>Q[5]then R(P,E(Q))Q[5]=U()+30 end end;return E(W)end end;net.mtu=4096;function net.lsend(L,A,B)local O={}for I=1,B:len(),net.mtu do O[#O+1]=B:sub(1,net.mtu)B=B:sub(net.mtu+1)end;for P,Q in ipairs(O)do net.send(L,A,Q)end end;function net.socket(X,A,Y)local D,Z={},""D.s,D.b,D.P,D.A="o","",tonumber(A),X;function D.r(a0,a1)Z=a0.b:sub(1,a1)a0.b=a0.b:sub(a1+1)return Z end;function D.w(a0,O)net.lsend(a0.A,a0.P,O)end;function D.c(a0)net.send(D.A,D.P,Y)D.s="c"end;function h(K,N,A,O)if N==D.A and A==D.P then if O==Y then net.hook[Y]=nil;D.s="c"return end;D.b=D.b..O end end;net.hook[Y]=h;return D end;t=r.pullSignal;function net.listen(a2)local N,A,O;p=v()repeat _,N,A,O=t(0.5)if v()-p>i then return{}end until A==a2 and O=="openstream"local a3,Y=u(2^15,2^16),w(u(-2^16,2^16))net.send(N,A,w(a3))net.send(N,a3,Y)return net.socket(N,a3,Y)end;local a4=x("modem")local a5=x("drone")local a6=x("robot")net.hn=c;a4.open(b)d=d.."::"e=e.."::"f=f.."::"if j then if a5~=nil then net.hn=net.hn.."_"..a5.name()elseif a6~=nil then net.hn=net.hn.."_"..a6.name()end end;if k then net.hn=net.hn.."_"..r.address()end;local a7,a8,a9;local function aa(...)return w(...)end;local function ab(ac)n:w(e.."\n"..aa(ac).."\n")end;local ad=function(ac)end;if l then local ae=ad;ad=function(ac)ac=aa(ac)if a5~=nil then a5.setStatusText(ac.."          \n"..string.sub(ac.."          ",11))end;ac=aa(ac)ae(ac)if n.s=="o"then n:w(f.."\n"..ac.."\n")end end end;local function af(...)r.beep(...)end;ad("BIOS "..a)ad("CP: "..e)ad("DCP: "..f)ad("Name: "..net.hn)while true do local ag=""p=v()while not q do if n.s~="o"then ag=""::ah::af(1000)ad("Wait for  stream")while n.s~="o"do local _,_,ai,_,_,aj,ac=t()if aj==d and ac=="get"then ad("GET")a4.send(ai,b,d,"get",net.hn,a)elseif aj==e and ac=="connect"then a4.send(ai,b,e,"connect",net.hn,true)n=net.listen(b)if n.s~="o"then ad("Failed")af(800,.5)goto ah else status=1 end end end;ad("Connected")p=v()end;package=n:r(#n.b)if package~=""then ag=ag..package;if string.sub(ag,-unicode.len(e))==e then ag=string.sub(ag,0,-unicode.len(e)-1)q=true end;p=v()end;if v()-p>i then ad("Timeout")ab("DEAD")n:c()elseif not q then t(g)end end;do ad("Load")ab("LOAD")local ak,al=load(ag)ag=""if ak~=nil then ad("Execute")ab("EXEC")local am,al=xpcall(ak,debug.traceback,net,n,b)ad("Exec suc: "..w(am))ab(w(am))if am~=true then ad(w(al))ab("ERR: "..w(al))af(600)af(600)af(800,.5)end else ad("Load err: "..al)ab(al)af(600)af(800,.5)end;q=false end end